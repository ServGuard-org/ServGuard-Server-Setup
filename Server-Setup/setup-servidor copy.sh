#!/bin/bash

echo '========================================================================================================='
echo 'Iniciando script de automacao' 
echo '========================================================================================================='

sudo apt upgrade && sudo apt update -y

echo '========================================================================================================='
echo 'Iniciando alteracoes de senha'
echo '========================================================================================================='

sudo chmod 640 /etc/shadow

sudo chmod 644 /etc/passwd

echo 'Ubuntu:urubu100' | sudo chpasswd

echo 'Root:urubu100' | sudo chpasswd

echo '========================================================================================================='
echo 'Instalando Git'
echo '========================================================================================================='

sudo apt install git 

echo '========================================================================================================='
echo 'Verificando versao do Git'
git --version
echo '========================================================================================================='

echo '========================================================================================================='
echo 'Instalando Docker'
echo '========================================================================================================='

sudo apt install docker.io -y

echo '========================================================================================================='
echo 'Verificando versao do Docker'
docker --version
echo '========================================================================================================='

echo '========================================================================================================='
echo 'iniciando e ativando servicos Docker'
echo '========================================================================================================='

sudo systemctl start docker

sudo systemctl enable docker

echo '========================================================================================================='
echo 'instalando docker compose'
echo '========================================================================================================='

sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

echo '========================================================================================================='
echo 'verificando se foi instalado'
echo '========================================================================================================='

docker-compose version

echo '========================================================================================================='
echo 'Clonando repositorio no github: ServGuard'
echo '========================================================================================================='

git clone https://github.com/ServGuard-org/ServGuard-WebSite.git
git clone https://github.com/ServGuard-org/ServGuard-Setups.git

echo '========================================================================================================='
echo 'Mudando de diretorio'
echo '========================================================================================================='

cd /home/ubuntu/ServGuard-Setups/Server-Setup/

echo '========================================================================================================='
echo 'Rodando docker-compose'
echo '========================================================================================================='

sudo docker-compose up

echo '========================================================================================================='
echo 'Listando as imagens'
echo '========================================================================================================='

sudo docker images

echo '========================================================================================================='
echo 'Verificando se os containers foram criados'
echo '========================================================================================================='

sudo docker ps -a